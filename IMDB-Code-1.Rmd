---
title: "Midterm"
output: html_notebook
---
Step 1: First we want import the IMDB Data from the csv & attach it to make it easier to work with

```{r}
imdb = read.csv("data_final.csv")
attach(imdb)
```

Step 2: Get a better look at the data overall
```{r}
head(imdb)
str(imdb) 
#We can see that the data is made up of integers, factors and a dummy variable for genre. Nice!
#We also have NA values that we need to deal with
```

Step 3: We can remove some unecessary columns: language, country, movie_imdb_link, plot_keywords, color, genres, plot summary, x-x.11
```{r}
imdb = imdb[,-c(1,5,15,28,31,35,58:70)]
```

Step 4: Lets loook at a summary of our data to see what we have in each column. We can see that we have a bunch of NA values so were going to have to deal with those.
```{r}
summary(imdb)
```
We have NA Values in:
distributor = 9
director = 3
production_company = 9
director_facebook_likes = 25 
actor_1_star_meter = 6 #dont need
critic_reviews_number = 10 
number_of_faces_in_movie_poster = 7 
movie_budget = 95 #removed them
ratio_movie_cast_likes = 3 
number_of_votes = 23

Step 5: Deal with Na Values
```{r}
#1 distributor - googled values
imdb$distributor = as.character(imdb$distributor)
distibutor <- subset(imdb, is.na(distributor))
distibutor

imdb$distributor[77] = "Paramount Pictures"
imdb$distributor[212] = "United Artists"
imdb$distributor[256] = "Sony Pictures"
imdb$distributor[483] = "Universal Pictures"
imdb$distributor[858] = "Shochiku Co., Ltd."
imdb$distributor[2341] = "Paramount Pictures"
imdb$distributor[2544] = "Columbia Pictures"
imdb$distributor[2663] = "Relativity Media"
imdb$distributor[3090] = "Missing" # Movie_title = H. Could not find distributor 
imdb$distributor[3105] = "Magnolia Pictures"

attach(imdb)
any(is.na(imdb$distributor))
```

```{r}
#2 director - googled values
imdb$director = as.character(imdb$director)
directors = subset(imdb, is.na(director))
directors
imdb$director[217] = "Peter Deluise"
imdb$director[365] = "Tibor Takics"
imdb$director[2080] = "Mark Steven Johnson" # this one was the date was also in 2003 not 2015

attach(imdb)
any(is.na(imdb$director))
```

```{r}
# 3 prodcution_company - googled values
imdb$production_company = as.character(imdb$production_company)
productionCompany = subset(imdb, is.na(production_company))
productionCompany

imdb$production_company[77] = "Indian Paintbrush"
imdb$production_company[212] = "Selznick International Pictures"
imdb$production_company[256] = "UK Film Council"
imdb$production_company[483] = "Blinding Edge Pictures"
imdb$production_company[858] = " Recorded Picture Company"
imdb$production_company[2341] = "Lakeshore Entertainment"
imdb$production_company[2544] = "Columbia Pictures"
imdb$production_company[2663] = "Relativity Media"
imdb$production_company[3090] = "Missing" # H. 
imdb$production_company[3105] = "Groundswell Productions"

attach(imdb)
any(is.na(imdb$production_company))
```

```{r}
#actor_1_star_meter
imdb$actor_1_star_meter = as.numeric(imdb$actor_1_star_meter)
actor1star = subset(imdb, is.na(imdb$actor_1_star_meter))
actor1star

imdb$actor_1_star_meter[443] = 2209
imdb$actor_1_star_meter[664] = 5368
imdb$actor_1_star_meter[671] = 5368
imdb$actor_1_star_meter[1494] = 2209
imdb$actor_1_star_meter[1979] = 2209
imdb$actor_1_star_meter[2102] = 5368
imdb$actor_1_star_meter[2304] = 5368
imdb$actor_1_star_meter[2490] = 5368
imdb$actor_1_star_meter[3119] = 5368

attach(imdb)
any(is.na(actor_1_star_meter))
```

```{r}
#number_of_faces_in_movie_poster
imdb$number_of_faces_in_movie_poster = as.numeric(imdb$number_of_faces_in_movie_poster)
faces = subset(imdb, is.na(number_of_faces_in_movie_poster))
faces

imdb$number_of_faces_in_movie_poster[274] = 1
imdb$number_of_faces_in_movie_poster[483] = 0
imdb$number_of_faces_in_movie_poster[529] = 6
imdb$number_of_faces_in_movie_poster[942] = 1
imdb$number_of_faces_in_movie_poster[1600] = 2
imdb$number_of_faces_in_movie_poster[2842] = 4
imdb$number_of_faces_in_movie_poster[2928] = 1

attach(imdb)
any(is.na(number_of_faces_in_movie_poster))
```

```{r}
#movie_budget
imdb$movie_budget = as.numeric(imdb$movie_budget)
budget = subset(imdb, is.na(movie_budget))
budget 

imdb$movie_budget[2988] = 1100000
imdb$movie_budget[2989] = 500000
imdb$movie_budget[2990] = 3000000
imdb$movie_budget[2991] = 10000000
imdb$movie_budget[2992] = 30000000
imdb$movie_budget[2993] = 2000000
imdb$movie_budget[2994] = 27000000
imdb$movie_budget[2995] = 5293040
imdb$movie_budget[2996] = 25000000
imdb$movie_budget[2997] = 6000000
imdb = imdb[-which(is.na(imdb$movie_budget)),]

attach(imdb)
any(is.na(movie_budget))
```

```{r}
#ratio_movie_cast_likes
imdb$ratio_movie_cast_likes = as.numeric(imdb$ratio_movie_cast_likes)
ratio = subset(imdb, is.na(ratio_movie_cast_likes))
ratio

imdb$ratio_movie_cast_likes[which(is.na(imdb$ratio_movie_cast_likes))] = mean(na.omit(imdb$ratio_movie_cast_likes)) # Replace with the mean

attach(imdb)
any(is.na(ratio_movie_cast_likes))
```

```{r}
#number_of_votes
imdb$number_of_votes = as.numeric(imdb$number_of_votes)
numberofvotes = subset(imdb, is.na(number_of_votes))
numberofvotes

imdb$number_of_votes[11] = 6788
imdb$number_of_votes[77] = 54489
imdb$number_of_votes[121] = 747
imdb$number_of_votes[191] = 2878
imdb$number_of_votes[212] = 0
imdb$number_of_votes[256] = 6134
imdb$number_of_votes[393] = 15966
imdb$number_of_votes[483] = 8
imdb$number_of_votes[517] = 2304
imdb$number_of_votes[550] = 7802
imdb$number_of_votes[857] = 64701
imdb$number_of_votes[897] = 75894
imdb$number_of_votes[1601] = 0
imdb$number_of_votes[1650] = 185684
imdb$number_of_votes[1679] = 306331
imdb$number_of_votes[1834] = 23392
imdb$number_of_votes[1953] = 95191
imdb$number_of_votes[1999] = 225660
imdb$number_of_votes[2273] = 99801
imdb$number_of_votes[2429] = 37294
imdb$number_of_votes[2663] = 77611
imdb$number_of_votes[2834] = 439627

attach(imdb)
any(is.na(number_of_votes))
```

```{r}
#critic reviews number
imdb$critic_reviews_number = as.numeric(imdb$critic_reviews_number)
critics = subset(imdb, is.na(critic_reviews_number))
critics

imdb$critic_reviews_number[15] = 0
imdb$critic_reviews_number[53] = 0
imdb$critic_reviews_number[107] = 0
imdb$critic_reviews_number[126] = 0
imdb$critic_reviews_number[274] = 6
imdb$critic_reviews_number[324] = 0
imdb$critic_reviews_number[363] = 0
imdb$critic_reviews_number[1336] = 86

attach(imdb)
any(is.na(critic_reviews_number))
```

```{r}
#duration_number
imdb$duration_mins = as.numeric(imdb$duration_mins)
mins = subset(imdb, is.na(duration_mins))
mins 

imdb$duration_mins[2812] = 130

attach(imdb)
any(is.na(imdb$duration_mins))
```

```{r}
imdb[which(is.na(imdb)), ]
imdb = na.omit(imdb)
```

Check if there are any NAs left in the dataset 
```{r}
any(is.na(imdb))
```

Step 7: Make character columns to numeric
```{r}
imdb$user_votes_number = as.numeric(imdb$user_votes_number)
imdb$movie_budget = as.numeric(imdb$movie_budget)
imdb$user_reviews_number = as.numeric(imdb$user_reviews_number)
imdb$actor_2_star_meter = as.numeric(imdb$actor_2_star_meter)
imdb$actor_3_facebook_likes = as.numeric(imdb$actor_3_facebook_likes)
imdb$actor_3_star_meter = as.numeric(imdb$actor_3_star_meter)
imdb$critic_reviews_number = as.numeric(imdb$critic_reviews_number)
imdb$movie_budget = as.numeric(imdb$movie_budget)
imdb$movie_facebook_likes = as.numeric(imdb$movie_facebook_likes)
```

Make factor columns to character 
```{r}
lapply(imdb, class)
imdb$title = as.character(imdb$title)
imdb$actor_1_known_for = as.character(imdb$actor_1_known_for)
imdb$actor_2_known_for = as.character(imdb$actor_2_known_for)
imdb$actor_3_known_for = as.character(imdb$actor_3_known_for)
imdb$director = as.character(imdb$director)
imdb$actor_1_name = as.character(imdb$actor_1_name)
imdb$actor_2_name = as.character(imdb$actor_2_name)
imdb$actor_3_name = as.character(imdb$actor_3_name)
imdb$cinematographer = as.character(imdb$cinematographer)
```
Fix the Color column (has an extra factor)
```{r}
which(imdb$color == "http://www.imdb.com/title/tt0160484/?ref_=fn_tt_tt_1")
imdb$color[which(imdb$color == "http://www.imdb.com/title/tt0160484/?ref_=fn_tt_tt_1")] = "Color"
```


Step 8: Correlation plot between numeric predictors 
```{r}
nums <- unlist(lapply(imdb, is.numeric))  
numericVars = imdb[,nums]
numericVars = numericVars[,-c(19:31)]
corPlot = cor(numericVars)
library(corrplot)
corrplot(corPlot, type = "lower", method = "pie",order = "hclust", 
         tl.col = "black", tl.srt = 25, tl.cex = 0.7)

```
Based off correlation matrix the following variables are significantly correlated: 
 1. number_news_articles and number_of_votes
 2. actor_2_facebook_likes and cast_total_facebook_likes
 3. actor_2_facebook_likes and sum_total_likes 
 4. actor_2_facebook_likes and cast_total_facebook_likes
 5. actor_1_facebook_likes and sum_total_likes 
 6. sum_total_likes and cast_total_facebook_likes 
 7. number_of_faces_in_movie_poster and ratio_movie_cast_likes
 8. movie_facebook_likes and ratio_movie_cast_likes
 9. movie_facebook_likes and number_of_faces_in_movie_poster
Honourable mentions:
 1. imdb_score and duration_mins (0.3)
 2. imdb_score and number_of_votes (0.5)

Step 9: Test model 
```{r}
multReg = lm(imdb_score~., data = numericVars)
summary(multReg)
```

Test model using step-wise to get most significant variables 
```{r}
# Step-wise regression
library(MASS)
step.model <- stepAIC(multReg, direction = "both", 
                      trace = FALSE)
summary(step.model)
```

Add in a few categorical variables and test the model
```{r}
modelSet = imdb[,-c(1,3,10,12,13,15,17,19,21,23,50,51)]
attach(modelSet)
multReg1 = lm(imdb_score~ ., data= modelSet)
summary(multReg1)
```

Bin variables with large number of factors
```{r}
# which columns are factors 
lapply(imdb, class)

```

```{r}
table(imdb$director)
library(caTools)
library(boot)

imdb$director_frequency <- table(imdb$director)[imdb$director]
imdb$director_column10 = ifelse(imdb$director_frequency >= 10, imdb$director, 'Other')
imdb$director_column10 = as.factor(imdb$director_column)
attach(imdb)

dirReg10 = glm(imdb_score~director_column10)
cv.glm(imdb, dirReg10, K=54)$delta[1]
summary(dirReg10)

imdb$director_column5 = ifelse(imdb$director_frequency >= 5, imdb$director, 'Other')
imdb$director_column5 = as.factor(imdb$director_column5)
attach(imdb)

dirReg5 = glm(imdb_score~director_column5)
cv.glm(imdb, dirReg5, K=54)$delta[1]
summary(dirReg)

imdb$director_column3 = ifelse(imdb$director_frequency >= 3, imdb$director, 'Other')
imdb$director_column3 = as.factor(imdb$director_column3)
attach(imdb)

dirReg3 = glm(imdb_score~director_column3)
cv.glm(imdb, dirReg3, K=54)$delta[1]
summary(dirReg)

```

```{r}
library(dplyr)

# Creating bins for distributor 
imdb$distributor_freq <- table(imdb$distributor)[imdb$distributor]
imdb$distributor10 = ifelse(imdb$distributor_freq >= 20, imdb$distributor, 'Other')
imdb$distributor10 = as.factor(imdb$distributor10)
attach(imdb)
relevel(imdb$distributor10, ref = "Other")

distReg10 = glm(imdb_score~distributor10)
cv.glm(imdb, distReg10, K=46)$delta[1]
summary(distReg10)

# Creating bins for actor 1
imdb$actor1_freq <- table(imdb$actor_1_name)[imdb$actor_1_name]
imdb$actor1_10 = ifelse(imdb$actor1_freq >= 10, imdb$actor_1_name, 'Other')
imdb$actor1_10 = as.factor(imdb$actor1_10)
attach(imdb)
relevel(imdb$actor1_10, ref = "Other")

act1Reg10 = glm(imdb_score~actor1_10)
cv.glm(imdb, act1Reg10, K=46)$delta[1]
summary(act1Reg10)

# bins for actor 2
imdb$actor2_freq <- table(imdb$actor_2_name)[imdb$actor_2_name]
imdb$actor2_10 = ifelse(imdb$actor2_freq >= 7, imdb$actor_2_name, 'Other')
imdb$actor2_10 = as.factor(imdb$actor2_10)
attach(imdb)
relevel(imdb$actor2_10, ref = "Other")

act2Reg10 = glm(imdb_score~actor2_10)
cv.glm(imdb, act2Reg10, K=46)$delta[1]
summary(act2Reg10)

# bins for actor 3
imdb$actor3_freq <- table(imdb$actor_3_name)[imdb$actor_3_name]
imdb$actor3_10 = ifelse(imdb$actor3_freq >= 5, imdb$actor_3_name, 'Other')
imdb$actor3_10 = as.factor(imdb$actor3_10)
attach(imdb)
relevel(imdb$actor3_10, ref = "Other")

act3Reg10 = glm(imdb_score~actor3_10)
cv.glm(imdb, act3Reg10, K=46)$delta[1]
summary(act3Reg10)

# binning cinematographer 
imdb$cin_freq <- table(imdb$cinematographer)[imdb$cinematographer]
imdb$cinematographer10 = ifelse(imdb$cin_freq >= 15, imdb$cinematographer, 'Other')
imdb$cinematographer10 = as.factor(imdb$cinematographer10)
attach(imdb)
relevel(imdb$cinematographer10, ref = "Other")

cinReg10 = glm(imdb_score~cinematographer10)
cv.glm(imdb, cinReg10, K=46)$delta[1]
summary(cinReg10)

# binning production co 
imdb$prod_freq <- table(imdb$production_company)[imdb$production_company]
imdb$prod10 = ifelse(imdb$prod_freq >= 20, imdb$production_company, 'Other')
imdb$prod10 = as.factor(imdb$prod10)
attach(imdb)
relevel(imdb$prod10, ref = "Other")

prodReg10 = glm(imdb_score~prod10)
cv.glm(imdb, prodReg10, K=46)$delta[1]
summary(prodReg10)

# changing aspect ratio to a factor
imdb$aspect_ratio = as.factor(imdb$aspect_ratio)
attach(imdb)
aspectReg10 = lm(imdb_score~aspect_ratio)
summary(aspectReg10)

```

Testing categorial variables in a model using step-wise 
```{r}

categoricalVar = imdb[,c(3,6:9,53,57,59,61,63,65,67)]
catReg = lm(imdb_score~.,data=categoricalVar)
summary(catReg)

library(MASS)
catStep <- stepAIC(catReg, direction = "both", 
                      trace = FALSE)
summary(catStep)
```

Combine numeric and categorical variables 
```{r}

```

